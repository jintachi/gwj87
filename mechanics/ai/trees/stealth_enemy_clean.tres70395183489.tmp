[gd_resource type="BehaviorTree" load_steps=25 format=3 uid="uid://dhrvg8g1qu7to"]

[ext_resource type="Script" uid="uid://ij4o3bchh0a2" path="res://mechanics/ai/tasks/detect_sight.gd" id="1_detect_sight"]
[ext_resource type="Script" uid="uid://dv0xjjp85ipgo" path="res://mechanics/ai/tasks/detect_hearing.gd" id="2_detect_hearing"]
[ext_resource type="Script" uid="uid://v3syuo1dplm7" path="res://mechanics/ai/tasks/manage_alert_level.gd" id="3_manage_alert"]
[ext_resource type="Script" uid="uid://byprrxavuj3d2" path="res://mechanics/ai/tasks/attack_player.gd" id="5_attack"]
[ext_resource type="Script" uid="uid://dd2wn274m4d7y" path="res://mechanics/ai/tasks/investigate_position.gd" id="6_investigate"]
[ext_resource type="Script" uid="uid://c3booajtmdl8f" path="res://mechanics/ai/tasks/resume_patrol.gd" id="7_resume_patrol"]
[ext_resource type="Script" uid="uid://b8k7nan2p4q5r" path="res://mechanics/ai/tasks/patrol.gd" id="8_patrol"]
[ext_resource type="Script" uid="uid://l2kwvbnvgry5" path="res://mechanics/ai/tasks/idle.gd" id="9_idle"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_clean"]
var/alert_level/name = &"alert_level"
var/alert_level/type = 2
var/alert_level/value = 0
var/alert_level/hint = 0
var/alert_level/hint_string = ""
var/player_visible/name = &"player_visible"
var/player_visible/type = 1
var/player_visible/value = false
var/player_visible/hint = 0
var/player_visible/hint_string = ""
var/player_audible/name = &"player_audible"
var/player_audible/type = 1
var/player_audible/value = false
var/player_audible/hint = 0
var/player_audible/hint_string = ""
var/last_sight_time/name = &"last_sight_time"
var/last_sight_time/type = 3
var/last_sight_time/value = 0.0
var/last_sight_time/hint = 0
var/last_sight_time/hint_string = ""
var/last_hearing_time/name = &"last_hearing_time"
var/last_hearing_time/type = 3
var/last_hearing_time/value = 0.0
var/last_hearing_time/hint = 0
var/last_hearing_time/hint_string = ""
var/last_sight_position/name = &"last_sight_position"
var/last_sight_position/type = 5
var/last_sight_position/value = Vector2(0, 0)
var/last_sight_position/hint = 0
var/last_sight_position/hint_string = ""
var/sound_position/name = &"sound_position"
var/sound_position/type = 5
var/sound_position/value = Vector2(0, 0)
var/sound_position/hint = 0
var/sound_position/hint_string = ""
var/investigation_target/name = &"investigation_target"
var/investigation_target/type = 5
var/investigation_target/value = Vector2(0, 0)
var/investigation_target/hint = 0
var/investigation_target/hint_string = ""
var/speed/name = &"speed"
var/speed/type = 3
var/speed/value = 200.0
var/speed/hint = 1
var/speed/hint_string = "10,1000,10"
var/waypoints/name = &"waypoints"
var/waypoints/type = 19
var/waypoints/value = Array[Vector2]([Vector2(0, 0), Vector2(200, 0), Vector2(200, 200), Vector2(0, 200)])
var/waypoints/hint = 0
var/waypoints/hint_string = ""
var/patrol_index/name = &"patrol_index"
var/patrol_index/type = 2
var/patrol_index/value = 0
var/patrol_index/hint = 0
var/patrol_index/hint_string = ""
var/detection_timer/name = &"detection_timer"
var/detection_timer/type = 3
var/detection_timer/value = 0.0
var/detection_timer/hint = 0
var/detection_timer/hint_string = ""
var/sight_detection_timer/name = &"sight_detection_timer"
var/sight_detection_timer/type = 3
var/sight_detection_timer/value = 0.0
var/sight_detection_timer/hint = 0
var/sight_detection_timer/hint_string = ""
var/not_visible_time/name = &"not_visible_time"
var/not_visible_time/type = 3
var/not_visible_time/value = 0.0
var/not_visible_time/hint = 0
var/not_visible_time/hint_string = ""
var/is_detecting/name = &"is_detecting"
var/is_detecting/type = 1
var/is_detecting/value = false
var/is_detecting/hint = 0
var/is_detecting/hint_string = ""
var/hearing_gauge/name = &"hearing_gauge"
var/hearing_gauge/type = 3
var/hearing_gauge/value = 0.0
var/hearing_gauge/hint = 1
var/hearing_gauge/hint_string = "0.0,1.0,0.01"
var/not_audible_time/name = &"not_audible_time"
var/not_audible_time/type = 3
var/not_audible_time/value = 0.0
var/not_audible_time/hint = 0
var/not_audible_time/hint_string = ""

[sub_resource type="BTAction" id="BTAction_detect_sight"]
script = ExtResource("1_detect_sight")

[sub_resource type="BTAction" id="BTAction_detect_hearing"]
script = ExtResource("2_detect_hearing")

[sub_resource type="BTAction" id="BTAction_manage_alert"]
script = ExtResource("3_manage_alert")

[sub_resource type="BTParallel" id="BTParallel_detection"]
custom_name = "Detection System"
children = [SubResource("BTAction_detect_sight"), SubResource("BTAction_detect_hearing"), SubResource("BTAction_manage_alert")]

[sub_resource type="BTAction" id="BTAction_attack"]
script = ExtResource("5_attack")

[sub_resource type="BTSequence" id="BTSequence_combat"]
custom_name = "Alert Level 2: Combat"
children = [SubResource("BTAction_attack")]

[sub_resource type="BTAction" id="BTAction_investigate"]
script = ExtResource("6_investigate")
alert_level_var = null
required_alert_level = null

[sub_resource type="BTSequence" id="BTSequence_alert"]
custom_name = "Alert Level 1: Investigate"
children = [SubResource("BTAction_investigate")]

[sub_resource type="BTAction" id="BTAction_resume_patrol"]
script = ExtResource("7_resume_patrol")

[sub_resource type="BTAction" id="BTAction_patrol"]
script = ExtResource("8_patrol")

[sub_resource type="BTAction" id="BTAction_idle"]
script = ExtResource("9_idle")

[sub_resource type="BTSelector" id="BTSelector_passive_behavior"]
custom_name = "Passive Behavior"
children = [SubResource("BTAction_patrol"), SubResource("BTAction_idle")]

[sub_resource type="BTSequence" id="BTSequence_passive"]
custom_name = "Alert Level 0: Passive"
children = [SubResource("BTAction_resume_patrol"), SubResource("BTSelector_passive_behavior")]

[sub_resource type="BTSelector" id="BTSelector_alert_levels"]
custom_name = "Alert Level Behavior"
children = [SubResource("BTSequence_combat"), SubResource("BTSequence_alert"), SubResource("BTSequence_passive")]

[sub_resource type="BTParallel" id="BTParallel_root"]
custom_name = "Root"
children = [SubResource("BTParallel_detection"), SubResource("BTSelector_alert_levels")]

[resource]
description = "Clean stealth enemy AI with alert level system (0-2). Detection runs independently, alert level determines behavior."
blackboard_plan = SubResource("BlackboardPlan_clean")
root_task = SubResource("BTParallel_root")
